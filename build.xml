<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
     2011/09/28 12:50:31                                                        

     GenomeMuseum    
     GenomeMuseum 0.8
                   
     higuchi                                                                
     ====================================================================== -->
<project name="GenomeMuseum" default="run-jar">
    <property name="build.dest" location="build"/>
    <property name="build.resources" location="build-resources"/>

    <property name="build.mac.app.name" value="GenomeMuseum.app"/>
    <property name="build.resources.macbundle" location="${build.resources}/Mac OS Bundle"/>
    
    <property name="target-jar" value="${basedir}/target/scala-2.9.1/genomemuseum_2.9.1-0.8a1.min.jar"/>
    <!-- jar ファイルが存在するかどうか -->
    <condition property="target-jar.exists">
        <available file="${target-jar}"></available>
    </condition>
    

    <description>
            GenomeMuseum 0.8
    </description>

    <!-- ================================= 
          target: default              
         ================================= -->
    <target name="sbt-proguard" depends="depends" description="GenomeMuseum 0.8" unless="target-jar.exists">
        <exec executable="sbt">
            <arg line="compile test package proguard"/>
  	</exec>
    </target>

    <!-- ================================= 
          target: run-jar              
         ================================= -->
    <target name="run-jar" depends="depends, sbt-proguard" description="target ディレクトリの jar を実行する">
        <java jar="${target-jar}" fork="true"></java>
    </target>

    <!-- ================================= 
          target: build-mac-app              
         ================================= -->
    <target name="build-mac-app" depends="depends, sbt-proguard" description="description">
        <property name="build.dest.mac.app" location="${build.dest}/${build.mac.app.name}"/>
        
        <delete dir="${build.dest.mac.app}" />
        <copy todir="${build.dest.mac.app}">
            <fileset dir="${build.resources.macbundle}"></fileset>
        </copy>
        <chmod file="${build.dest.mac.app}/Contents/MacOS/JavaApplicationStub" perm="a+x"></chmod>
        <copy file="${target-jar}"
            tofile="${build.dest.mac.app}/Contents/Resources/Java/genomemuseum.jar" />
    </target>

    <!-- ================================= 
          target: build-win-exe              
         ================================= -->
    <target name="build-win-exe" depends="depends, sbt-proguard" description="description">
        <!-- ${launch4j.home} launch4j.jar と lib/xstream.jar があるディレクトリを指定しておく。 -->
        <taskdef name="launch4j" classname="net.sf.launch4j.ant.Launch4jTask"
            classpath="${launch4j.home}/launch4j.jar:${launch4j.home}/xstream.jar" />
        <launch4j configFile="${build.resources}/launch4j.xml" />
    </target>
    
    <!-- - - - - - - - - - - - - - - - - - 
          target: depends                      
         - - - - - - - - - - - - - - - - - -->
    <target name="depends">
        <mkdir dir="${build.dest}"/>
    </target>
</project>
